{% extends "base.html" %}

{% block title %}Liste des tickets{% endblock %}

{% block content %}
<h1 class="mb-4">Liste des tickets</h1>

<!-- Formulaire de recherche et filtres -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" action="{{ url_for('tickets_list') }}">
            <div class="row g-3">
                <div class="col-md-3">
                    <input type="text" class="form-control" name="search" 
                           placeholder="üîç Rechercher..." 
                           value="{{ recherche }}">
                </div>
                <div class="col-md-2">
                    <select class="form-select" name="statut">
                        <option value="">Tous les statuts</option>
                        <option value="Ouvert" {% if filtre_statut == 'Ouvert' %}selected{% endif %}>Ouvert</option>
                        <option value="En cours" {% if filtre_statut == 'En cours' %}selected{% endif %}>En cours</option>
                        <option value="R√©solu" {% if filtre_statut == 'R√©solu' %}selected{% endif %}>R√©solu</option>
                        <option value="Ferm√©" {% if filtre_statut == 'Ferm√©' %}selected{% endif %}>Ferm√©</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" name="priorite">
                        <option value="">Toutes les priorit√©s</option>
                        <option value="Haute" {% if filtre_priorite == 'Haute' %}selected{% endif %}>Haute</option>
                        <option value="Normale" {% if filtre_priorite == 'Normale' %}selected{% endif %}>Normale</option>
                        <option value="Basse" {% if filtre_priorite == 'Basse' %}selected{% endif %}>Basse</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" name="categorie">
                        <option value="">Toutes les cat√©gories</option>
                        <option value="Logiciel" {% if filtre_categorie == 'Logiciel' %}selected{% endif %}>Logiciel</option>
                        <option value="Mat√©riel" {% if filtre_categorie == 'Mat√©riel' %}selected{% endif %}>Mat√©riel</option>
                        <option value="R√©seau" {% if filtre_categorie == 'R√©seau' %}selected{% endif %}>R√©seau</option>
                        <option value="Autre" {% if filtre_categorie == 'Autre' %}selected{% endif %}>Autre</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-outline-primary">Filtrer</button>
                </div>
            </div>
        </form>
    </div>
</div>

{% if tickets %}
<table class="table table-striped">
    <thead>
        <tr>
            <th>#</th>
            <th>Titre</th>
            <th>Priorit√©</th>
            <th>Cat√©gorie</th>
            <th>Note</th>
            <th>Statut</th>
        </tr>
    </thead>
    <tbody>
    {% for t in tickets %}
        <tr>
            <td>{{ t["id"] }}</td>
            <td><a href="{{ url_for('ticket_detail', ticket_id=t["id"]) }}">{{ t["titre"] }}</a></td>
            <td>{% if t["priorite"] == "Haute" %}
                <span class="badge bg-danger">{{ t["priorite"] }}</span>
            {% elif t["priorite"] == "Normale" %}
                <span class="badge bg-warning text-dark">{{ t["priorite"] }}</span>
            {% elif t["priorite"] == "Basse" %}
                <span class="badge bg-success">{{ t["priorite"] }}</span>
            {% endif %}</td>
            <td>{{ t["categorie"] }}</td>
            <td>
                {% if t["note"] %}
                    <span class="badge bg-success">Oui</span>
                {% else %}
                    <span class="badge bg-secondary">Non</span>
                {% endif %}
                </td>
            <td>{{ t["statut"] }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>Aucun ticket pour l‚Äôinstant.</p>
{% endif %}

<a class="btn btn-primary" href="{{ url_for('ticket_new') }}">Cr√©er un ticket</a>
{% endblock %}
